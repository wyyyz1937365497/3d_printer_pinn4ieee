# æ•°æ®æ”¶é›†ä¸è®­ç»ƒå®Œæ•´æŒ‡å—

**é¡¹ç›®**: 3Dæ‰“å°æœºè½¨è¿¹è¯¯å·®é¢„æµ‹ä¸ä¿®æ­£
**æ›´æ–°æ—¥æœŸ**: 2026-01-31
**ç›®çš„**: ä½¿ç”¨å›ºä»¶å¢å¼ºä»¿çœŸæ•°æ®è®­ç»ƒè¯¯å·®ä¿®å¤ç¥ç»ç½‘ç»œ

---

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [æ•°æ®æ”¶é›†](#æ•°æ®æ”¶é›†)
3. [æ•°æ®å‡†å¤‡](#æ•°æ®å‡†å¤‡)
4. [æ¨¡å‹è®­ç»ƒ](#æ¨¡å‹è®­ç»ƒ)
5. [æ¨¡å‹è¯„ä¼°](#æ¨¡å‹è¯„ä¼°)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€å°åŒ–æµç¨‹ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# 1. æ”¶é›†å•ä¸ªæ–‡ä»¶çš„é‡‡æ ·æ•°æ®ï¼ˆ5å±‚ï¼Œçº¦10åˆ†é’Ÿï¼‰
matlab -batch "collect_3dbenchy('sampled:5')"

# 2. å‡†å¤‡è®­ç»ƒæ•°æ®
python data/scripts/prepare_training_data.py

# 3. è®­ç»ƒæ¨¡å‹
python experiments/train_trajectory_model.py --epochs 50

# 4. è¯„ä¼°æ¨¡å‹
python experiments/evaluate_trajectory_model.py
```

---

## ğŸ“Š æ•°æ®æ”¶é›†

### æ­¥éª¤1: MATLABä»¿çœŸ

#### æ–¹å¼1: ä½¿ç”¨ä¾¿æ·è„šæœ¬ï¼ˆæ¨èï¼‰

é¡¹ç›®å·²ä¸ºæ¯ä¸ªgcodeæ–‡ä»¶åˆ›å»ºäº†ä¾¿æ·è„šæœ¬ï¼š

```matlab
% æ”¶é›†3DBenchyçš„é‡‡æ ·æ•°æ®ï¼ˆæ¯5å±‚é‡‡æ ·1å±‚ï¼‰
collect_3dbenchy('sampled:5');

% æ”¶é›†Bearingçš„é‡‡æ ·æ•°æ®
collect_bearing5('sampled:5');

% æ”¶é›†Nautilusçš„é‡‡æ ·æ•°æ®
collect_nautilus('sampled:5');

% æ”¶é›†Boatçš„é‡‡æ ·æ•°æ®
collect_boat('sampled:5');
```

#### æ–¹å¼2: æ‰¹é‡æ”¶é›†æ‰€æœ‰æ–‡ä»¶

```matlab
% æ”¶é›†æ‰€æœ‰æ–‡ä»¶ï¼Œæ¯5å±‚é‡‡æ ·1å±‚
collect_all  % è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰gcodeæ–‡ä»¶
```

#### æ–¹å¼3: ä½¿ç”¨æ ¸å¿ƒå‡½æ•°ï¼ˆçµæ´»ï¼‰

```matlab
% å•ä¸ªæ–‡ä»¶ï¼ŒæŒ‡å®šå±‚èŒƒå›´
collect_data('test_gcode_files/3DBenchy_PLA_1h28m.gcode', 1:50, ...
             'GPU', 1, ...
             'UseFirmwareEffects', true);  % ä½¿ç”¨å›ºä»¶å¢å¼ºä»¿çœŸ

% å¤šä¸ªæ–‡ä»¶ï¼Œä¸åŒé…ç½®
files = {'file1.gcode', 'file2.gcode'};
configs = {'sampled:5', 'all'};
collect_data(files, configs, 'UseFirmwareEffects', true);
```

### å±‚æ•°é…ç½®è¯´æ˜

| é…ç½® | å«ä¹‰ | ç¤ºä¾‹ | ç”¨é€” |
|------|------|------|------|
| `'all'` | æ‰€æœ‰å±‚ | 1:48 | å®Œæ•´æ•°æ®ï¼ˆæ—¶é—´é•¿ï¼‰ |
| `'sampled:N'` | æ¯Nå±‚é‡‡æ ·1å±‚ | sampled:5 | å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰ |
| `start:end` | æŒ‡å®šèŒƒå›´ | 1:20 | éƒ¨åˆ†æ•°æ® |
| å•å±‚ | å•ä¸ªå±‚ | 25 | è°ƒè¯• |

### æ¨èçš„æ•°æ®æ”¶é›†ç­–ç•¥

**ç­–ç•¥1: å¿«é€ŸéªŒè¯**ï¼ˆ~30åˆ†é’Ÿï¼‰
```matlab
% æ¯ä¸ªæ–‡ä»¶é‡‡æ ·5å±‚
collect_3dbenchy('sampled:10');  % çº¦5å±‚
collect_bearing5('sampled:10');
collect_nautilus('sampled:10');
% æ€»è®¡: ~15å±‚ Ã— 3æ–‡ä»¶ Ã— 2åˆ†é’Ÿ/å±‚ = ~90åˆ†é’Ÿ
```

**ç­–ç•¥2: æ ‡å‡†è®­ç»ƒ**ï¼ˆ~2å°æ—¶ï¼‰
```matlab
% æ¯ä¸ªæ–‡ä»¶é‡‡æ ·5å±‚
collect_3dbenchy('sampled:5');   % çº¦10å±‚
collect_bearing5('sampled:5');   % çº¦10å±‚
collect_nautilus('sampled:5');   % çº¦10å±‚
collect_boat('sampled:5');       % çº¦10å±‚
% æ€»è®¡: ~40å±‚ Ã— 2åˆ†é’Ÿ/å±‚ = ~80åˆ†é’Ÿ
```

**ç­–ç•¥3: å®Œæ•´æ•°æ®**ï¼ˆ~6å°æ—¶ï¼‰
```matlab
% æ‰€æœ‰æ–‡ä»¶çš„æ‰€æœ‰å±‚
collect_all
% æ€»è®¡: ~200å±‚ Ã— 2åˆ†é’Ÿ/å±‚ = ~400åˆ†é’Ÿ
```

### æŸ¥çœ‹ç°æœ‰æ•°æ®

```bash
# æ£€æŸ¥å·²æ”¶é›†çš„æ•°æ®
ls -lh data_simulation_*/

# ç»Ÿè®¡æ•°æ®ç‚¹
python check_data_stats.py
```

### å›ºä»¶å¢å¼ºä»¿çœŸå‚æ•°

å½“å‰é…ç½®ï¼ˆå·²åœ¨`collect_data.m`ä¸­è®¾ç½®ï¼‰ï¼š

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| `UseFirmwareEffects` | `true` | å¯ç”¨å›ºä»¶å¢å¼ºï¼ˆ0.1mmè¯¯å·®ï¼‰ |
| `GPU` | `1` | ä½¿ç”¨GPUåŠ é€Ÿ |
| `Resume` | `true` | è·³è¿‡å·²å®Œæˆçš„å±‚ |

**éªŒè¯è¯¯å·®èŒƒå›´**:

```matlab
% æµ‹è¯•å›ºä»¶å¢å¼ºä»¿çœŸ
test_firmware_effects_simple

% é¢„æœŸè¾“å‡º:
%   RMSè¯¯å·®: ~140 Î¼m âœ…
%   æœ€å¤§è¯¯å·®: 80-150 Î¼m âœ…
```

---

## ğŸ”„ æ•°æ®å‡†å¤‡

### æ­¥éª¤2: ç”Ÿæˆè®­ç»ƒæ•°æ®é›†

MATLABä»¿çœŸç”Ÿæˆçš„`.mat`æ–‡ä»¶éœ€è¦è½¬æ¢ä¸ºPyTorchå¯ç”¨çš„æ ¼å¼ã€‚

#### è¿è¡Œæ•°æ®å‡†å¤‡è„šæœ¬

```bash
# åŸºç¡€ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
python data/scripts/prepare_training_data.py \
    --data_dirs data_simulation_* \
    --output_dir data/processed \
    --sequence_length 128 \
    --stride 4
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--data_dirs` | `data_simulation_*` | è¾“å…¥æ•°æ®ç›®å½•ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰ |
| `--output_dir` | `data/processed` | è¾“å‡ºç›®å½• |
| `--sequence_length` | `128` | åºåˆ—é•¿åº¦ï¼ˆæ—¶é—´æ­¥ï¼‰ |
| `--stride` | `4` | é‡‡æ ·æ­¥é•¿ï¼ˆè¶Šå°æ•°æ®è¶Šå¤šï¼‰ |
| `--train_ratio` | `0.8` | è®­ç»ƒé›†æ¯”ä¾‹ |
| `--val_ratio` | `0.1` | éªŒè¯é›†æ¯”ä¾‹ |
| `--test_ratio` | `0.1` | æµ‹è¯•é›†æ¯”ä¾‹ |

#### æ•°æ®å¢å¼ºé€‰é¡¹

```bash
# æ·»åŠ å™ªå£°å¢å¼º
python data/scripts/prepare_training_data.py \
    --augment_noise \
    --noise_level 0.01

# æ·»åŠ æ—¶åºåç§»å¢å¼º
python data/scripts/prepare_training_data.py \
    --augment_temporal \
    --temporal_shift 5
```

#### æ•°æ®é›†ç»Ÿè®¡

æŸ¥çœ‹ç”Ÿæˆçš„æ•°æ®é›†ï¼š

```bash
# æŸ¥çœ‹æ•°æ®é›†ä¿¡æ¯
python -c "
from data.simulation.dataset import PrinterSimulationDataset
dataset = PrinterSimulationDataset('data/processed/train')
print(f'æ ·æœ¬æ•°: {len(dataset)}')
print(f'ç‰¹å¾ç»´åº¦: {dataset[0][\"input_features\"].shape}')
print(f'ç›®æ ‡ç»´åº¦: {dataset[0][\"trajectory_targets\"].shape}')
"
```

**é¢„æœŸè¾“å‡º**:
```
æ ·æœ¬æ•°: ~50000
ç‰¹å¾ç»´åº¦: torch.Size([128, 15])  # 128æ—¶é—´æ­¥, 15ç‰¹å¾
ç›®æ ‡ç»´åº¦: torch.Size([128, 2])   # 128æ—¶é—´æ­¥, 2è½´è¯¯å·®
```

---

## ğŸ§  æ¨¡å‹è®­ç»ƒ

### æ­¥éª¤3: é…ç½®è®­ç»ƒå‚æ•°

#### åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨`config/`ç›®å½•åˆ›å»ºè‡ªå®šä¹‰é…ç½®ï¼š

```python
# config/my_training_config.py
from config.base_config import BaseConfig

class MyConfig(BaseConfig):
    # æ•°æ®é…ç½®
    data:
        root_dir: 'data/processed'
        batch_size: 32
        num_workers: 4
        sequence_length: 128
        stride: 4

    # æ¨¡å‹é…ç½®
    model:
        type: 'TrajectoryErrorTransformer'
        d_model: 256
        nhead: 8
        num_layers: 6
        dim_feedforward: 1024
        dropout: 0.1

    # è®­ç»ƒé…ç½®
    training:
        epochs: 100
        learning_rate: 0.0001
        weight_decay: 0.0001
        early_stopping_patience: 15
        mixed_precision: true
        gradient_clip: 1.0

    # è®¾å¤‡é…ç½®
    device: 'cuda'  # æˆ– 'cpu'
    experiment_name: 'trajectory_error_correction'
    log_dir: 'logs/run1'
```

### æ­¥éª¤4: å¼€å§‹è®­ç»ƒ

#### åŸºç¡€è®­ç»ƒå‘½ä»¤

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®è®­ç»ƒ
python experiments/train_trajectory_model.py

# æŒ‡å®šé…ç½®æ–‡ä»¶
python experiments/train_trajectory_model.py \
    --config config/my_training_config.py

# è¦†ç›–ç‰¹å®šå‚æ•°
python experiments/train_trajectory_model.py \
    --epochs 100 \
    --batch_size 64 \
    --lr 0.0001 \
    --gpu 0
```

#### å®Œæ•´è®­ç»ƒç¤ºä¾‹

```bash
# è®­ç»ƒ100ä¸ªepochï¼Œæ‰¹æ¬¡å¤§å°32ï¼Œå­¦ä¹ ç‡0.0001
python experiments/train_trajectory_model.py \
    --data_root data/processed \
    --batch_size 32 \
    --epochs 100 \
    --lr 0.0001 \
    --device cuda:0 \
    --experiment_name firmware_enhanced_v1 \
    --log_dir logs/firmware_v1 \
    --save_dir checkpoints/firmware_v1 \
    --mixed_precision \
    --early_stopping_patience 15
```

#### è®­ç»ƒå‚æ•°è¯¦è§£

| å‚æ•° | æ¨èå€¼ | è¯´æ˜ |
|------|--------|------|
| `--epochs` | 50-100 | è®­ç»ƒè½®æ•° |
| `--batch_size` | 32-64 | æ‰¹æ¬¡å¤§å°ï¼ˆGPUå†…å­˜å…è®¸è¶Šå¤§è¶Šå¥½ï¼‰ |
| `--lr` | 0.0001 | å­¦ä¹ ç‡ |
| `--device` | `cuda:0` | è®¾å¤‡ï¼ˆ`cuda:0`, `cuda:1`, `cpu`ï¼‰ |
| `--mixed_precision` | - | å¯ç”¨æ··åˆç²¾åº¦è®­ç»ƒï¼ˆæ›´å¿«ï¼‰ |
| `--gradient_clip` | 1.0 | æ¢¯åº¦è£å‰ªï¼ˆé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼‰ |
| `--early_stopping_patience` | 15 | æ—©åœè€å¿ƒå€¼ |

#### ç›‘æ§è®­ç»ƒè¿›åº¦

è®­ç»ƒæ—¶ä¼šå®æ—¶æ˜¾ç¤ºï¼š

```
Epoch 1/100
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100%
    Batch   20/156 | Loss: 0.023456 | X-Err: 0.012345 | Y-Err: 0.011234 | Throughput:   512 samples/s
    Batch   40/156 | Loss: 0.021234 | X-Err: 0.011234 | Y-Err: 0.010123 | Throughput:   508 samples/s
    ...
  â–¶ Train Loss: 0.019876 | X-Err: 0.010234 | Y-Err: 0.009876
  â–¶ Val Loss: 0.018765 | X-Err: 0.009876 | Y-Err: 0.009234
  âœ“ Saved checkpoint: checkpoints/firmware_v1/best_model.pt
```

#### ä½¿ç”¨TensorBoardç›‘æ§

```bash
# å¯åŠ¨TensorBoard
tensorboard --logdir logs/firmware_v1 --port 6006

# æµè§ˆå™¨æ‰“å¼€
# http://localhost:6006
```

**ç›‘æ§æŒ‡æ ‡**:
- æŸå¤±æ›²çº¿ï¼ˆTrain/Val Lossï¼‰
- X/Yè½´è¯¯å·®ï¼ˆX-Err/Y-Errï¼‰
- å­¦ä¹ ç‡å˜åŒ–
- æ¢¯åº¦åˆ†å¸ƒ

---

## ğŸ“ˆ æ¨¡å‹è¯„ä¼°

### æ­¥éª¤5: è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹

#### åŸºç¡€è¯„ä¼°

```bash
# è¯„ä¼°æœ€ä½³æ¨¡å‹
python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/firmware_v1/best_model.pt \
    --data_root data/processed/test
```

#### è¯¦ç»†è¯„ä¼°

```bash
# å®Œæ•´è¯„ä¼°æŠ¥å‘Š
python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/firmware_v1/best_model.pt \
    --data_root data/processed/test \
    --output_dir results/evaluation \
    --visualize \
    --save_predictions
```

#### è¯„ä¼°æŒ‡æ ‡

**å…³é”®æŒ‡æ ‡**:

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| **MAE (Xè½´)** | < 0.02 mm | å¹³å‡ç»å¯¹è¯¯å·® |
| **MAE (Yè½´)** | < 0.02 mm | å¹³å‡ç»å¯¹è¯¯å·® |
| **RMSE (Xè½´)** | < 0.03 mm | å‡æ–¹æ ¹è¯¯å·® |
| **RMSE (Yè½´)** | < 0.03 mm | å‡æ–¹æ ¹è¯¯å·® |
| **RÂ² (Xè½´)** | > 0.85 | å†³å®šç³»æ•° |
| **RÂ² (Yè½´)** | > 0.85 | å†³å®šç³»æ•° |

**ç¤ºä¾‹è¾“å‡º**:
```
===========================================
Trajectory Error Model Evaluation
===========================================
Dataset: Test (5234 samples)

Overall Metrics:
  MAE:  0.0156 mm
  RMSE: 0.0223 mm
  RÂ²:   0.8923

Per-Axis Metrics:
  X-Axis:
    MAE:  0.0145 mm
    RMSE: 0.0201 mm
    RÂ²:   0.9012

  Y-Axis:
    MAE:  0.0167 mm
    RMSE: 0.0245 mm
    RÂ²:   0.8834

Percentile Errors:
  50th (Median): 0.0123 mm
  90th:         0.0345 mm
  95th:         0.0456 mm
  99th:         0.0678 mm

âœ“ Model meets performance targets!
===========================================
```

### å¯è§†åŒ–ç»“æœ

#### ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨

```python
# ä½¿ç”¨å¯è§†åŒ–è„šæœ¬
python experiments/visualize_trajectory_correction.py \
    --checkpoint checkpoints/firmware_v1/best_model.pt \
    --data_dir data/processed/test \
    --num_samples 10 \
    --output_dir results/visualizations
```

**ç”Ÿæˆçš„å›¾è¡¨**:
1. `trajectory_comparison.png` - åä¹‰è½¨è¿¹ vs ä¿®æ­£è½¨è¿¹
2. `error_distribution.png` - è¯¯å·®åˆ†å¸ƒç›´æ–¹å›¾
3. `error_correlation.png` - é¢„æµ‹è¯¯å·® vs çœŸå®è¯¯å·®æ•£ç‚¹å›¾
4. `per_axis_error.png` - X/Yè½´è¯¯å·®å¯¹æ¯”
5. `sequence_prediction.png` - åºåˆ—é¢„æµ‹ç¤ºä¾‹

#### äº¤äº’å¼å¯è§†åŒ–

```python
# Jupyter Notebookä¸­ä½¿ç”¨
from models.trajectory import TrajectoryErrorTransformer
from data.simulation.dataset import PrinterSimulationDataset
import torch

# åŠ è½½æ¨¡å‹
model = TrajectoryErrorTransformer.load_from_checkpoint(
    'checkpoints/firmware_v1/best_model.pt'
)

# åŠ è½½æ•°æ®
dataset = PrinterSimulationDataset('data/processed/test')
sample = dataset[0]

# é¢„æµ‹
with torch.no_grad():
    predictions = model(sample['input_features'].unsqueeze(0))

# å¯è§†åŒ–
import matplotlib.pyplot as plt

plt.figure(figsize=(15, 5))

# å­å›¾1: åä¹‰è½¨è¿¹
plt.subplot(1, 3, 1)
plt.plot(sample['trajectory_targets'][:, 0], label='True X')
plt.plot(predictions['error_x'][0, :, 0], label='Pred X', linestyle='--')
plt.title('X-Axis Error')
plt.legend()

# å­å›¾2: Yè½´è¯¯å·®
plt.subplot(1, 3, 2)
plt.plot(sample['trajectory_targets'][:, 1], label='True Y')
plt.plot(predictions['error_y'][0, :, 0], label='Pred Y', linestyle='--')
plt.title('Y-Axis Error')
plt.legend()

# å­å›¾3: è¯¯å·®å¹…å€¼
plt.subplot(1, 3, 3)
true_mag = torch.sqrt(sample['trajectory_targets'][:, 0]**2 +
                      sample['trajectory_targets'][:, 1]**2)
pred_mag = torch.sqrt(predictions['error_x'][0, :, 0]**2 +
                      predictions['error_y'][0, :, 0]**2)
plt.plot(true_mag, label='True')
plt.plot(pred_mag, label='Pred', linestyle='--')
plt.title('Error Magnitude')
plt.legend()

plt.tight_layout()
plt.savefig('prediction_visualization.png', dpi=150)
plt.show()
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: MATLABä»¿çœŸå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**: ä¼˜åŒ–ç­–ç•¥ï¼š

1. **å‡å°‘é‡‡æ ·å±‚æ•°**:
   ```matlab
   collect_3dbenchy('sampled:20');  % æ¯20å±‚é‡‡æ ·1å±‚ï¼ˆè€Œé5å±‚ï¼‰
   ```

2. **ä½¿ç”¨GPUåŠ é€Ÿ**ï¼ˆå·²é»˜è®¤å¯ç”¨ï¼‰:
   ```matlab
   collect_data(..., 'GPU', 1);
   ```

3. **å¹¶è¡Œå¤„ç†**:
   ```matlab
   % å¼€å¯å¤šä¸ªMATLABå®ä¾‹ï¼ŒåŒæ—¶æ”¶é›†ä¸åŒæ–‡ä»¶
   % å®ä¾‹1:
   collect_3dbenchy('sampled:5');
   % å®ä¾‹2:
   collect_bearing5('sampled:5');
   ```

4. **å‡å°‘åºåˆ—é•¿åº¦**:
   ```matlab
   % åœ¨reconstruct_trajectoryä¸­ä¿®æ”¹time_step
   trajectory_options.time_step = 0.02;  % ä»0.01æ”¹ä¸º0.02
   ```

### Q2: è®­ç»ƒæ—¶æ˜¾å­˜ä¸è¶³ï¼ˆCUDA OOMï¼‰

**A**: è§£å†³æ–¹æ¡ˆï¼š

1. **å‡å°æ‰¹æ¬¡å¤§å°**:
   ```bash
   python train_trajectory_model.py --batch_size 16  # ä»32å‡åˆ°16
   ```

2. **å‡å°åºåˆ—é•¿åº¦**:
   ```bash
   python prepare_training_data.py --sequence_length 64  # ä»128å‡åˆ°64
   ```

3. **å¯ç”¨æ¢¯åº¦ç´¯ç§¯**:
   ```python
   # ä¿®æ”¹è®­ç»ƒè„šæœ¬
   accumulation_steps = 4
   if (batch_idx + 1) % accumulation_steps == 0:
       optimizer.step()
       optimizer.zero_grad()
   ```

4. **ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ**ï¼ˆå·²é»˜è®¤å¯ç”¨ï¼‰:
   ```bash
   python train_trajectory_model.py --mixed_precision
   ```

### Q3: æ¨¡å‹ä¸æ”¶æ•›ï¼ˆLossä¸ä¸‹é™ï¼‰

**A**: æ’æŸ¥æ­¥éª¤ï¼š

1. **æ£€æŸ¥æ•°æ®è´¨é‡**:
   ```python
   python check_data_stats.py
   # ç¡®è®¤è¯¯å·®èŒƒå›´åœ¨0.1mmå·¦å³
   ```

2. **è°ƒæ•´å­¦ä¹ ç‡**:
   ```bash
   # å°è¯•æ›´å°çš„å­¦ä¹ ç‡
   python train_trajectory_model.py --lr 0.00001
   ```

3. **ä½¿ç”¨å­¦ä¹ ç‡è°ƒåº¦å™¨**ï¼ˆå·²å†…ç½®ï¼‰:
   ```python
   # é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®ReduceLROnPlateau
   scheduler:
       type: 'reduce_on_plateau'
       factor: 0.5
       patience: 5
   ```

4. **å¢åŠ æ¨¡å‹å®¹é‡**:
   ```python
   # å¢åŠ Transformerå±‚æ•°æˆ–éšè—ç»´åº¦
   model:
       num_layers: 8  # ä»6å¢åŠ åˆ°8
       d_model: 512   # ä»256å¢åŠ åˆ°512
   ```

### Q4: è¯¯å·®é¢„æµ‹ä¸å‡†ç¡®

**A**: æ”¹è¿›ç­–ç•¥ï¼š

1. **å¢åŠ æ•°æ®é‡**:
   ```matlab
   % æ”¶é›†æ›´å¤šå±‚æ•°
   collect_3dbenchy('sampled:3');  # ä»5æ”¹ä¸º3ï¼ˆæ›´å¤šå±‚ï¼‰
   ```

2. **æ·»åŠ æ•°æ®å¢å¼º**:
   ```bash
   python prepare_training_data.py --augment_noise --noise_level 0.01
   ```

3. **è°ƒæ•´åºåˆ—é•¿åº¦**:
   ```bash
   # æ›´é•¿çš„åºåˆ—å¯èƒ½æ•æ‰æ›´å¤šä¸Šä¸‹æ–‡
   python prepare_training_data.py --sequence_length 256
   ```

4. **å°è¯•ä¸åŒçš„æ¨¡å‹æ¶æ„**:
   ```python
   # ä¿®æ”¹Transformerçš„å¤´æ•°æˆ–å±‚æ•°
   model:
       nhead: 16  # ä»8å¢åŠ åˆ°16
       num_layers: 8
   ```

### Q5: å¦‚ä½•æ¢å¤ä¸­æ–­çš„è®­ç»ƒï¼Ÿ

**A**: ä»æ£€æŸ¥ç‚¹æ¢å¤ï¼š

```bash
# è®­ç»ƒè„šæœ¬ä¼šè‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹
# checkpoints/firmware_v1/last_model.pt
# checkpoints/firmware_v1/best_model.pt

# ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒ
python train_trajectory_model.py \
    --resume checkpoints/firmware_v1/last_model.pt \
    --epochs 200  # ç»§ç»­è®­ç»ƒæ›´å¤šè½®
```

### Q6: å¦‚ä½•åœ¨æ–°æ•°æ®ä¸Šæµ‹è¯•ï¼Ÿ

**A**: æ¨ç†æµç¨‹ï¼š

```python
from models.trajectory import TrajectoryErrorTransformer
import torch

# åŠ è½½æ¨¡å‹
model = TrajectoryErrorTransformer.load_from_checkpoint(
    'checkpoints/firmware_v1/best_model.pt'
)
model.eval()

# å‡†å¤‡è¾“å…¥æ•°æ®
# input_features: [batch_size, sequence_length, num_features]
input_features = prepare_your_data()

# é¢„æµ‹
with torch.no_grad():
    predictions = model(input_features)

# æå–è¯¯å·®
error_x = predictions['error_x']  # [batch_size, sequence_length, 1]
error_y = predictions['error_y']  # [batch_size, sequence_length, 1]

# åº”ç”¨ä¿®æ­£
corrected_x = nominal_x - error_x
corrected_y = nominal_y - error_y
```

### Q7: å¦‚ä½•å¯¹æ¯”ä¸åŒæ¨¡å‹ï¼Ÿ

**A**: åŸºå‡†æµ‹è¯•ï¼š

```bash
# è®­ç»ƒå¤šä¸ªæ¨¡å‹
python train_trajectory_model.py --exp_name model_v1 --lr 0.0001
python train_trajectory_model.py --exp_name model_v2 --lr 0.00005
python train_trajectory_model.py --exp_name model_v3 --lr 0.0002

# å¯¹æ¯”è¯„ä¼°
python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/model_v1/best_model.pt \
    --output_dir results/model_v1

python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/model_v2/best_model.pt \
    --output_dir results/model_v2

python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/model_v3/best_model.pt \
    --output_dir results/model_v3

# ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
python -c "
import pandas as pd
import json

results = {}
for name in ['model_v1', 'model_v2', 'model_v3']:
    with open(f'results/{name}/metrics.json') as f:
        results[name] = json.load(f)

df = pd.DataFrame(results).T
print(df[['mae', 'rmse', 'r2']])
"
```

---

## ğŸ“š é™„å½•

### A. å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

```bash
# ========== ç¬¬1å¤©ï¼šæ•°æ®æ”¶é›† ==========
# MATLABå‘½ä»¤çª—å£
matlab

% åœ¨MATLABä¸­æ‰§è¡Œï¼š
collect_3dbenchy('sampled:5');
collect_bearing5('sampled:5');
collect_nautilus('sampled:5');

exit  % é€€å‡ºMATLAB

# ========== ç¬¬1å¤©ï¼ˆæ™šä¸Šï¼‰ï¼šæ•°æ®å‡†å¤‡ ==========
# Bash/PowerShell
cd F:\TJ\3d_print\3d_printer_pinn4ieee

python data/scripts/prepare_training_data.py \
    --data_dirs data_simulation_* \
    --output_dir data/processed \
    --sequence_length 128 \
    --stride 4

# ========== ç¬¬2å¤©ï¼šæ¨¡å‹è®­ç»ƒ ==========
# è®­ç»ƒæ¨¡å‹ï¼ˆçº¦2-4å°æ—¶ï¼‰
python experiments/train_trajectory_model.py \
    --epochs 100 \
    --batch_size 32 \
    --lr 0.0001 \
    --experiment_name firmware_enhanced_v1 \
    --mixed_precision

# ========== ç¬¬2å¤©ï¼ˆä¸‹åˆï¼‰ï¼šæ¨¡å‹è¯„ä¼° ==========
# è¯„ä¼°æ¨¡å‹
python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/firmware_enhanced_v1/best_model.pt \
    --visualize \
    --save_predictions

# ========== ç¬¬3å¤©ï¼šç»“æœåˆ†æ ==========
# æŸ¥çœ‹ç»“æœ
python -c "
import json
with open('results/evaluation/metrics.json') as f:
    metrics = json.load(f)
print(json.dumps(metrics, indent=2))
"

# ç”Ÿæˆå¯è§†åŒ–
python experiments/visualize_trajectory_correction.py \
    --checkpoint checkpoints/firmware_enhanced_v1/best_model.pt \
    --num_samples 20
```

### B. æ•°æ®éœ€æ±‚ä¼°ç®—

| æ¨¡å‹è§„æ¨¡ | å‚æ•°é‡ | æ¨èæ•°æ®é‡ | è®­ç»ƒæ—¶é—´ |
|---------|--------|-----------|---------|
| å°å‹ | 1-2M | 50K-100K æ ·æœ¬ | 1-2å°æ—¶ |
| ä¸­å‹ï¼ˆå½“å‰ï¼‰ | 5M | 200K-500K æ ·æœ¬ | 2-4å°æ—¶ |
| å¤§å‹ | 10M+ | 1M+ æ ·æœ¬ | 6-12å°æ—¶ |

**è®¡ç®—å…¬å¼**:
```
æ•°æ®é‡ (æ ·æœ¬) = å±‚æ•° Ã— ç‚¹/å±‚ / stride Ã— sequence_length
```

**ç¤ºä¾‹**:
```
40å±‚ Ã— 2000ç‚¹/å±‚ / 4 stride Ã— 128 seq_len = 256,000 æ ·æœ¬
```

### C. ç¡¬ä»¶éœ€æ±‚

**æœ€ä½é…ç½®**:
- CPU: 4æ ¸
- RAM: 8 GB
- GPU: æ— ï¼ˆCPUè®­ç»ƒï¼Œæ…¢10-20å€ï¼‰
- å­˜å‚¨: 10 GB

**æ¨èé…ç½®**:
- CPU: 8æ ¸
- RAM: 16 GB
- GPU: GTX 1080 æˆ–æ›´å¥½ï¼ˆ8 GB VRAMï¼‰
- å­˜å‚¨: 20 GB SSD

**ç†æƒ³é…ç½®**:
- CPU: 16æ ¸
- RAM: 32 GB
- GPU: RTX 3080 æˆ–æ›´å¥½ï¼ˆ10+ GB VRAMï¼‰
- å­˜å‚¨: 50 GB NVMe SSD

### D. è®­ç»ƒæ—¶é—´ä¼°ç®—

| é…ç½® | æ‰¹æ¬¡å¤§å° | æ¯epochæ—¶é—´ | æ€»æ—¶é—´ï¼ˆ100 epochsï¼‰ |
|------|---------|------------|-------------------|
| CPU (i7-8700K) | 16 | ~15åˆ†é’Ÿ | ~25å°æ—¶ |
| GPU (GTX 1080) | 32 | ~3åˆ†é’Ÿ | ~5å°æ—¶ |
| GPU (RTX 3080) | 64 | ~1åˆ†é’Ÿ | ~2å°æ—¶ |

**æ³¨**: å®é™…æ—¶é—´å–å†³äºæ•°æ®é‡ã€åºåˆ—é•¿åº¦ã€æ¨¡å‹å¤§å°ã€‚

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒå¡ç‰‡

### æ•°æ®æ”¶é›†
```matlab
% å¿«é€Ÿæµ‹è¯•
collect_3dbenchy('sampled:10');  % ~5å±‚

% æ ‡å‡†è®­ç»ƒ
collect_3dbenchy('sampled:5');   % ~10å±‚

% å®Œæ•´æ•°æ®
collect_3dbenchy('all');         % ~48å±‚
```

### æ•°æ®å‡†å¤‡
```bash
python data/scripts/prepare_training_data.py \
    --data_dirs data_simulation_* \
    --output_dir data/processed
```

### æ¨¡å‹è®­ç»ƒ
```bash
python experiments/train_trajectory_model.py \
    --epochs 100 \
    --batch_size 32 \
    --lr 0.0001
```

### æ¨¡å‹è¯„ä¼°
```bash
python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/firmware_enhanced_v1/best_model.pt
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-01-31
**ä½œè€…**: 3D Printer PINN Project
