# 🚀 快速开始指南

**3D打印机轨迹误差预测与修正系统**

---

## ⚡ 5分钟快速开始

### 第1步：收集数据（MATLAB）

```matlab
% 打开MATLAB，切换到项目目录
cd('F:\TJ\3d_print\3d_printer_pinn4ieee')
addpath(genpath(fullfile(pwd, 'matlab_simulation')))

% 收集采样数据（约10分钟，生成~10层数据）
collect_3dbenchy('sampled:5')
```

**预期输出**:
```
待处理层数: 10
输出目录: data_simulation_3DBenchy_PLA_1h28m_sampled_10layers
✓ 完成
```

### 第2步：准备训练数据（Python）

```bash
# 在PowerShell/Bash中执行
python data/scripts/prepare_training_data.py \
    --data_dirs data_simulation_3DBenchy* \
    --output_dir data/processed
```

**预期输出**:
```
Processing data_simulation_3DBenchy...
  Loaded 10 layers
  Generated 25600 samples
  Train: 20480, Val: 2560, Test: 2560
✓ Data preparation complete!
```

### 第3步：训练模型

```bash
python experiments/train_trajectory_model.py \
    --epochs 50 \
    --batch_size 32
```

**预期输出**:
```
Epoch 1/50
  Train Loss: 0.0234 | X-Err: 0.0123 | Y-Err: 0.0112
  Val Loss: 0.0198 | X-Err: 0.0101 | Y-Err: 0.0098
  ✓ Saved checkpoint
...
Training complete! Best val loss: 0.0156
```

### 第4步：评估模型

```bash
python experiments/evaluate_trajectory_model.py \
    --checkpoint checkpoints/firmware_enhanced_v1/best_model.pt
```

**预期输出**:
```
Overall Metrics:
  MAE:  0.0156 mm ✅
  RMSE: 0.0223 mm ✅
  R²:   0.8923 ✅
```

---

## 📊 完整数据收集流程

### 收集所有文件的数据（推荐）

```matlab
% 方法1：使用便捷脚本（最简单）
collect_all

% 方法2：逐个收集
collect_3dbenchy('sampled:5');
collect_bearing5('sampled:5');
collect_nautilus('sampled:5');
collect_boat('sampled:5');
```

**时间估算**: 40层 × 2分钟/层 ≈ **80分钟**

### 验证数据质量

```matlab
% 测试固件增强仿真
test_firmware_effects_simple

% 确认输出：
%   RMS误差: ~140 μm ✅
%   目标范围: 80-150 μm ✅
```

---

## 🎓 训练最佳实践

### 推荐配置（标准训练）

```bash
python experiments/train_trajectory_model.py \
    --data_root data/processed \
    --batch_size 32 \
    --epochs 100 \
    --lr 0.0001 \
    --device cuda:0 \
    --experiment_name firmware_enhanced_v1 \
    --mixed_precision \
    --early_stopping_patience 15
```

### 监控训练进度

**终端1：训练**
```bash
python train_trajectory_model.py
```

**终端2：TensorBoard**
```bash
tensorboard --logdir logs/firmware_v1
# 浏览器打开 http://localhost:6006
```

---

## 📈 检查结果

### 1. 查看检查点

```bash
ls -lh checkpoints/firmware_enhanced_v1/

# 输出：
# best_model.pt   ← 验证集最佳模型
# last_model.pt   ← 最新epoch模型
# checkpoint.pt   ← 训练状态（用于恢复）
```

### 2. 查看训练日志

```bash
cat logs/firmware_v1/train.log

# 查看每个epoch的loss和误差
```

### 3. 可视化结果

```python
# Python脚本
import matplotlib.pyplot as plt
import torch
from models.trajectory import TrajectoryErrorTransformer

# 加载模型
model = TrajectoryErrorTransformer.load_from_checkpoint(
    'checkpoints/firmware_enhanced_v1/best_model.pt'
)

# 预测
predictions = model(input_batch)

# 绘图
plt.plot(predictions['error_x'][0].detach().numpy())
plt.title('X-Axis Error Prediction')
plt.show()
```

---

## 🔧 常见问题速查

| 问题 | 解决方案 |
|------|---------|
| **MATLAB太慢** | 减少层数：`'sampled:10'` 而非 `'sampled:5'` |
| **GPU内存不足** | 减小batch_size：`--batch_size 16` |
| **模型不收敛** | 降低学习率：`--lr 0.00001` |
| **数据量不足** | 增加层数或减少stride |
| **恢复训练** | 添加：`--resume checkpoints/.../last_model.pt` |

---

## 📚 详细文档

- **完整指南**: [数据收集与训练指南.md](./数据收集与训练指南.md)
- **技术文档**: [固件增强仿真系统_技术文档.md](./固件增强仿真系统_技术文档.md)
- **论文参考**: [论文方法论_轨迹误差仿真.md](./论文方法论_轨迹误差仿真.md)

---

## ✅ 检查清单

开始前确认：

- [ ] MATLAB已安装并配置好路径
- [ ] Python 3.8+已安装
- [ ] PyTorch已安装（`torch.__version__` >= 1.12）
- [ ] CUDA可用（如使用GPU）：`torch.cuda.is_available()`
- [ ] gcode文件在`test_gcode_files/`目录
- [ ] 有足够的磁盘空间（~20 GB）

---

## 🎯 下一步

1. **完成快速开始** → 运行5分钟版本
2. **收集完整数据** → 使用`collect_all`
3. **训练完整模型** → 100 epochs
4. **评估与优化** → 调整超参数
5. **实际应用** → 部署到打印机

---

**需要帮助？** 查看 [数据收集与训练指南.md](./数据收集与训练指南.md) 的"常见问题"章节。

**版本**: 1.0 | **日期**: 2026-01-31
